
/**
 * Salary Structure Utility for Nigerian Civil Service
 * Based on provided Salary Structure JSON
 */

interface SalaryStructure {
    [gradeLevel: string]: {
        [step: string]: number;
    };
}

export interface DetailedSalary {
    basicSalary: number;
    grossSalary: number;
    netSalary: number;
    allowances: number;
    deductions: {
        tax: number;
        pension: number;
        nhf: number;
        total: number;
    };
    isStoppage: boolean;
    stoppageReason?: string;
}

interface SalaryScales {
    [scale: string]: SalaryStructure;
}

// Data transformed from salarystructure.json
export const SALARY_DATA: SalaryScales = {
    "CORE": {
        "01": { "01": 30051, "02": 30385, "03": 30719, "04": 31053, "05": 31387, "06": 31721, "07": 32054, "08": 32388, "09": 32722, "10": 33056, "11": 33390, "12": 33724, "13": 34058, "14": 34392, "15": 34726 },
        "02": { "01": 30329, "02": 30663, "03": 30997, "04": 31331, "05": 31665, "06": 31999, "07": 32333, "08": 32667, "09": 33000, "10": 33334, "11": 33668, "12": 34002, "13": 34336, "14": 34670, "15": 35004 },
        "03": { "01": 30663, "02": 30997, "03": 31331, "04": 31665, "05": 31999, "06": 32333, "07": 32667, "08": 33000, "09": 33334, "10": 33668, "11": 34002, "12": 34336, "13": 34670, "14": 35004, "15": 35338 },
        "04": { "01": 31359, "02": 31693, "03": 32027, "04": 32360, "05": 32694, "06": 32949, "07": 33362, "08": 33695, "09": 34030, "10": 34364, "11": 34698, "12": 35032, "13": 35366, "14": 35699, "15": 36033 },
        "05": { "01": 32611, "02": 32945, "03": 33279, "04": 33613, "05": 33947, "06": 34280, "07": 34614, "08": 34948, "09": 35282, "10": 35516, "11": 35950, "12": 36284, "13": 36618, "14": 36952, "15": 37286 },
        "06": { "01": 34906, "02": 35240, "03": 35574, "04": 35908, "05": 36242, "06": 36576, "07": 36910, "08": 37244, "09": 37578, "10": 37912, "11": 38245, "12": 38579, "13": 38913, "14": 39247, "15": 39581 },
        "07": { "01": 35697, "02": 35972, "03": 36247, "04": 36522, "05": 36797, "06": 37072, "07": 37347, "08": 37622, "09": 37897, "10": 38172, "11": 38448, "12": 38723, "13": 38998, "14": 39273, "15": 39548 },
        "08": { "01": 36282, "02": 36526, "03": 36771, "04": 37016, "05": 37260, "06": 37505, "07": 37749, "08": 37994, "09": 38239, "10": 38483, "11": 38728, "12": 38973, "13": 39217, "14": 39462, "15": 39707 },
        "09": { "01": 37568, "02": 37799, "03": 38030, "04": 38261, "05": 38492, "06": 38723, "07": 38954, "08": 39185, "09": 40109, "10": 40340, "11": 40571, "12": 40802, "13": 41033, "14": 41264, "15": 41495 },
        "10": { "01": 46777, "02": 47008, "03": 47239, "04": 47470, "05": 47701, "06": 47932, "07": 48163, "08": 48394, "09": 48625, "10": 48856, "11": 49087, "12": 49318, "13": 49549, "14": 49780, "15": 50011 },
        "12": { "01": 53452, "02": 53683, "03": 53914, "04": 54145, "05": 54376, "06": 54607, "07": 54838, "08": 55069, "09": 55300, "10": 55531, "11": 55762 },
        "13": { "01": 60441, "02": 60572, "03": 60903, "04": 61134, "05": 61365, "06": 61596, "07": 61827, "08": 62058, "09": 62289, "10": 62520, "11": 62751 },
        "14": { "01": 68596, "02": 68827, "03": 69058, "04": 69289, "05": 69520, "06": 69751, "07": 69982, "08": 70213, "09": 70444, "10": 70675, "11": 70906 },
        "15": { "01": 87400, "02": 87627, "03": 90014, "04": 88081, "05": 88307, "06": 88534, "07": 88761, "08": 88988, "09": 89215 },
        "16": { "01": 121495, "02": 121723, "03": 121949, "04": 122176, "05": 122403, "06": 122630, "07": 122857, "08": 123083, "09": 123310 }
    },
    "SUBEB": {
        "01": { "01": 30051, "02": 30385, "03": 30719, "04": 31053, "05": 31387, "06": 31721, "07": 32054, "08": 32388, "09": 32722, "10": 33056, "11": 33390, "12": 33724, "13": 34058, "14": 34392, "15": 34726 },
        "02": { "01": 30329, "02": 30663, "03": 30997, "04": 31331, "05": 31665, "06": 31999, "07": 32333, "08": 32667, "09": 33000, "10": 33334, "11": 33668, "12": 34002, "13": 34336, "14": 34670, "15": 35004 },
        "03": { "01": 30663, "02": 30997, "03": 31331, "04": 31665, "05": 31999, "06": 32333, "07": 32667, "08": 33000, "09": 33334, "10": 33668, "11": 34002, "12": 34336, "13": 34670, "14": 35004, "15": 35338 },
        "04": { "01": 31359, "02": 31693, "03": 32027, "04": 32360, "05": 32694, "06": 32949, "07": 33362, "08": 33696, "09": 34030, "10": 34364, "11": 34698, "12": 35032, "13": 35366, "14": 35699, "15": 36033 },
        "05": { "01": 32611, "02": 32945, "03": 33279, "04": 33613, "05": 33947, "06": 34280, "07": 34614, "08": 34948, "09": 35282, "10": 35616, "11": 35950, "12": 36284, "13": 36618, "14": 36952, "15": 37286 },
        "06": { "01": 34906, "02": 35240, "03": 35574, "04": 35908, "05": 36242, "06": 36576, "07": 36910, "08": 37244, "09": 37578, "10": 37912, "11": 38245, "12": 38579, "13": 38913, "14": 39247, "15": 39581 },
        "07": { "01": 33571, "02": 33830, "03": 34089, "04": 34347, "05": 34606, "06": 34865, "07": 35123, "08": 35382, "09": 35641, "10": 35900, "11": 36158, "12": 36417, "13": 36676, "14": 36934, "15": 37193 },
        "08": { "01": 36282, "02": 36526, "03": 36771, "04": 37016, "05": 37260, "06": 37505, "07": 37749, "08": 37994, "09": 38239, "10": 38483, "11": 38728, "12": 38973, "13": 39217, "14": 39462, "15": 39707 },
        "09": { "01": 37568, "02": 37799, "03": 38030, "04": 38261, "05": 38492, "06": 38723, "07": 38954, "08": 39185, "09": 40109, "10": 40340, "11": 40571, "12": 40802, "13": 41088, "14": 41264, "15": 41495 },
        "10": { "01": 46777, "02": 47008, "03": 47239, "04": 47470, "05": 47701, "06": 47932, "07": 48163, "08": 48394, "09": 48625, "10": 48856, "11": 49087, "12": 49318, "13": 49549, "14": 49780, "15": 50011 },
        "12": { "01": 53452, "02": 53683, "03": 53914, "04": 54145, "05": 54376, "06": 54607, "07": 54838, "08": 55069, "09": 55300, "10": 55531, "11": 55762 },
        "13": { "01": 60441, "02": 60672, "03": 60903, "04": 61134, "05": 61365, "06": 61596, "07": 61827, "08": 62058, "09": 62289, "10": 62520, "11": 62751 },
        "14": { "01": 68596, "02": 68827, "03": 69058, "04": 69289, "05": 69520, "06": 69751, "07": 69982, "08": 70213, "09": 70444, "10": 70675, "11": 70906 },
        "15": { "01": 87400, "02": 87627, "03": 90014, "04": 88081, "05": 88307, "06": 88534, "07": 88761, "08": 88988, "09": 89215 },
        "16": { "01": 121496, "02": 121723, "03": 121949, "04": 122176, "05": 122403, "06": 122630, "07": 122857, "08": 123083, "09": 123310 }
    },
    "EXEC_AUDIT": {
        "01": { "01": 37038, "02": 37287, "03": 37536, "04": 37786, "05": 38035, "06": 38285, "07": 38534, "08": 38784, "09": 39033, "10": 39282, "11": 39532, "12": 39781, "13": 40031, "14": 40280, "15": 40529 },
        "02": { "01": 37381, "02": 37630, "03": 37879, "04": 38129, "05": 38378, "06": 38628, "07": 38877, "08": 39126, "09": 39376, "10": 39625, "11": 39875, "12": 40124, "13": 40373, "14": 40623, "15": 40872 },
        "03": { "01": 37792, "02": 38042, "03": 38291, "04": 38540, "05": 38790, "06": 39039, "07": 39289, "08": 39538, "09": 39787, "10": 40037, "11": 40286, "12": 40536, "13": 40785, "14": 41034, "15": 41284 },
        "04": { "01": 38649, "02": 38899, "03": 39148, "04": 39398, "05": 39647, "06": 39897, "07": 40146, "08": 40395, "09": 40645, "10": 40894, "11": 41144, "12": 41393, "13": 41642, "14": 41892, "15": 42141 },
        "05": { "01": 41427, "02": 41677, "03": 41926, "04": 42176, "05": 42425, "06": 42674, "07": 42924, "08": 43173, "09": 43423, "10": 43672, "11": 43921, "12": 44171, "13": 44420, "14": 44670, "15": 44919 },
        "06": { "01": 44462, "02": 44712, "03": 44961, "04": 45211, "05": 45460, "06": 45709, "07": 45959, "08": 46208, "09": 46458, "10": 46707, "11": 46956, "12": 47206, "13": 47455, "14": 47706, "15": 47954 },
        "07": { "01": 43944, "02": 44137, "03": 44331, "04": 44524, "05": 44717, "06": 44910, "07": 45104, "08": 45297, "09": 45490, "10": 45683, "11": 45877, "12": 46070, "13": 46263, "14": 46456, "15": 46650 },
        "08": { "01": 44968, "02": 45141, "03": 45313, "04": 45486, "05": 45658, "06": 45831, "07": 46003, "08": 46176, "09": 46348, "10": 46521, "11": 46693, "12": 46866, "13": 47039, "14": 47211, "15": 47384 },
        "09": { "01": 51972, "02": 52145, "03": 52318, "04": 52490, "05": 52663, "06": 52835, "07": 53008, "08": 53180, "09": 53353, "10": 53525, "11": 53698, "12": 53870, "13": 54043, "14": 54216, "15": 54388 },
        "10": { "01": 61600, "02": 61772, "03": 61945, "04": 62118, "05": 62290, "06": 62463, "07": 62635, "08": 62808, "09": 62980, "10": 63153, "11": 63325, "12": 63498, "13": 63670, "14": 63843, "15": 64016 },
        "12": { "01": 73821, "02": 73994, "03": 74166, "04": 74339, "05": 74511, "06": 74684, "07": 74856, "08": 75029, "09": 75201, "10": 75374, "11": 75547 },
        "13": { "01": 82179, "02": 82352, "03": 82524, "04": 82697, "05": 82869, "06": 83042, "07": 83214, "08": 83387, "09": 83559, "10": 83732, "11": 83904 },
        "14": { "01": 93140, "02": 93312, "03": 93485, "04": 93658, "05": 93830, "06": 94003, "07": 94175, "08": 94348, "09": 94520, "10": 94693, "11": 94865 }
    },
    "TEACHERS_NP": {
        "07": { "01": 34521, "02": 34783, "03": 35045, "04": 35307, "05": 35569, "06": 35831, "07": 36093, "08": 36355, "09": 36617, "10": 36879, "11": 37141, "12": 37403, "13": 37665, "14": 37927, "15": 38189 },
        "08": { "01": 35136, "02": 35369, "03": 35602, "04": 35835, "05": 36068, "06": 36301, "07": 36534, "08": 36767, "09": 37000, "10": 37233, "11": 37466, "12": 37699, "13": 37932, "14": 38165, "15": 38398 },
        "09": { "01": 36549, "02": 36769, "03": 36989, "04": 37209, "05": 37429, "06": 37649, "07": 37869, "08": 38089, "09": 38309, "10": 38529, "11": 38749, "12": 38969, "13": 39189, "14": 39409, "15": 39629 },
        "10": { "01": 45375, "02": 45595, "03": 45815, "04": 46035, "05": 46255, "06": 46475, "07": 46695, "08": 46915, "09": 47135, "10": 47355, "11": 47575, "12": 47795, "13": 48015, "14": 48235, "15": 48455 },
        "12": { "01": 51952, "02": 52172, "03": 52392, "04": 52612, "05": 52832, "06": 53052, "07": 53272, "08": 53492, "09": 53712, "10": 53932, "11": 54152 },
        "13": { "01": 58718, "02": 58938, "03": 59158, "04": 59378, "05": 59598, "06": 59818, "07": 60038, "08": 60258, "09": 60478, "10": 60698, "11": 60918 },
        "14": { "01": 66594, "02": 66814, "03": 67034, "04": 67254, "05": 67474, "06": 67694, "07": 67914, "08": 68134, "09": 68354, "10": 68574, "11": 68794 },
        "15": { "01": 84696, "02": 84912, "03": 85128, "04": 85344, "05": 85560, "06": 85776, "07": 85992, "08": 86208, "09": 86424 },
        "16": { "01": 117330, "02": 117546, "03": 117762, "04": 117978, "05": 118194, "06": 118410, "07": 118626, "08": 118842, "09": 119058 }
    },
    "TEACHERS_P": {
        "07": { "01": 35045, "02": 35307, "03": 35569, "04": 35831, "05": 36093, "06": 36355, "07": 36617, "08": 36879, "09": 37141, "10": 37403, "11": 37665, "12": 37927, "13": 38189, "14": 38451, "15": 38713 },
        "08": { "01": 35719, "02": 35952, "03": 36185, "04": 36418, "05": 36651, "06": 36884, "07": 37117, "08": 37350, "09": 37583, "10": 37816, "11": 38049, "12": 38282, "13": 38515, "14": 38748, "15": 38981 },
        "09": { "01": 38979, "02": 39199, "03": 39419, "04": 39639, "05": 39859, "06": 40079, "07": 40299, "08": 40519, "09": 40739, "10": 40959, "11": 41179, "12": 41399, "13": 41619, "14": 41839, "15": 42059 },
        "10": { "01": 46200, "02": 46420, "03": 46640, "04": 46860, "05": 47080, "06": 47300, "07": 47520, "08": 47740, "09": 47960, "10": 48180, "11": 48400, "12": 48620, "13": 48840, "14": 49060, "15": 49280 },
        "12": { "01": 55366, "02": 55586, "03": 55806, "04": 56026, "05": 56246, "06": 56466, "07": 56686, "08": 56906, "09": 57126, "10": 57346, "11": 57566 },
        "13": { "01": 59873, "02": 60093, "03": 60313, "04": 60533, "05": 60753, "06": 60973, "07": 61193, "08": 61413, "09": 61633, "10": 61853, "11": 62073 },
        "14": { "01": 67859, "02": 68079, "03": 68299, "04": 68519, "05": 68739, "06": 68959, "07": 69179, "08": 69399, "09": 69619, "10": 69839, "11": 70059 },
        "15": { "01": 86154, "02": 86370, "03": 86586, "04": 86802, "05": 87018, "06": 87234, "07": 87450, "08": 87666, "09": 87882 },
        "16": { "01": 118950, "02": 119166, "03": 119382, "04": 119598, "05": 119814, "06": 120080, "07": 120246, "08": 120462, "09": 120678 }
    }
};



/**
 * Calculates the basic annual salary based on Grade Level, Step and Salary Scale
 * Legacy function using hardcoded data
 */
export function calculateSalary(
    gradeLevel: string | null | undefined,
    step: string | null | undefined,
    scale: string | null | undefined = "CORE"
): number {
    if (!gradeLevel || !step) return 0;

    // Default to CORE if scale is missing or invalid
    const scaleKey = (scale || "CORE").toUpperCase();
    const structure = SALARY_DATA[scaleKey] || SALARY_DATA["CORE"];

    // Ensure we match the key format "01", "08", etc.
    const glKey = gradeLevel.padStart(2, '0');
    const stepKey = step.padStart(2, '0');

    return structure[glKey]?.[stepKey] || 0;
}

/**
 * Calculates a detailed salary breakdown including allowances and deductions
 */
export function calculateDetailedSalary(
    gradeLevel: string | null | undefined,
    step: string | null | undefined,
    scale: string | null | undefined = "CORE",
    isSuspended: boolean = false,
    leaveType?: string | null
): DetailedSalary {
    const basic = calculateSalary(gradeLevel, step, scale);

    // Stoppage Logic
    if (isSuspended) {
        return {
            basicSalary: 0, grossSalary: 0, netSalary: 0, allowances: 0,
            deductions: { tax: 0, pension: 0, nhf: 0, total: 0 },
            isStoppage: true, stoppageReason: "SUSPENDED"
        };
    }

    if (leaveType === 'STUDY_WITHOUT_PAY') {
        return {
            basicSalary: 0, grossSalary: 0, netSalary: 0, allowances: 0,
            deductions: { tax: 0, pension: 0, nhf: 0, total: 0 },
            isStoppage: true, stoppageReason: "LEAVE_WITHOUT_PAY"
        };
    }

    // Civil Service Math (Simplified for now as requested)
    // Allowances roughly 40-60% of basic in many cadres
    const allowanceRate = (scale === 'TEACHERS_P' || scale === 'EXEC_AUDIT') ? 0.6 : 0.45;
    const allowances = basic * allowanceRate;
    const gross = basic + allowances;

    // Deductions
    const pension = basic * 0.08; // 8% Pension
    const nhf = basic * 0.025; // 2.5% NHF
    const tax = gross * 0.07; // 7% Flat Tax (Estimated)

    const totalDeductions = pension + nhf + tax;
    const net = gross - totalDeductions;

    return {
        basicSalary: basic,
        grossSalary: gross,
        netSalary: net,
        allowances,
        deductions: {
            tax, pension, nhf,
            total: totalDeductions
        },
        isStoppage: false
    };
}

/**
 * Calculates what the presumed step should be based on years of service
 * Usually 1 step increment per year
 */
export function getPresumedStep(dofa: Date, entryStep: number = 1): number {
    const now = new Date();
    const serviceYears = Math.floor((now.getTime() - dofa.getTime()) / (1000 * 60 * 60 * 24 * 365.25));

    // Step normally increments annually up to 15
    const presumedStep = entryStep + serviceYears;
    return Math.min(presumedStep, 15);
}

/**
 * Formats a number as Naira currency
 */
export function formatNaira(amount: number | string): string {
    const num = typeof amount === 'string' ? parseFloat(amount) : amount;
    if (isNaN(num)) return "â‚¦ 0.00";
    return new Intl.NumberFormat('en-NG', {
        style: 'currency',
        currency: 'NGN',
        minimumFractionDigits: 0,
        maximumFractionDigits: 0
    }).format(num);
}
